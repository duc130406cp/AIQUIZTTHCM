<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AI Quiz T∆∞ t∆∞·ªüng HCM</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    .quote {
      text-align: center;
      margin-bottom: 40px;
    }
    .quote h1 {
      font-size: 28px;
      margin: 5px 0;
    }
    .quote p {
      font-size: 18px;
      font-style: italic;
      margin-top: 10px;
      color: #555;
    }
    #quiz, #mainContent {
      margin-top: 30px;
    }
    #feedback {
      margin-top: 15px;
    }
    #nextBtn {
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="quote">
    <h1>‚ÄúH·ªçc ƒë·ªÉ l√†m vi·ªác, l√†m ng∆∞·ªùi, l√†m c√°n b·ªô.</h1>
    <h1>H·ªçc ƒë·ªÉ ph·ª•ng s·ª± nh√¢n d√¢n v√† t·ªï qu·ªëc.‚Äù</h1>
    <p>‚Äî H·ªì Ch√≠ Minh ‚Äî</p>
  </div>

  <!-- API key input -->
  <div id="apiKeyPrompt">
    <h3>Vui l√≤ng nh·∫≠p API Key:</h3>
    <input type="text" id="apiKeyInput" placeholder="D√°n API key c·ªßa b·∫°n..." style="width: 300px;">
    <button onclick="checkAndContinue()">Ti·∫øp t·ª•c</button>
    <p>Link l·∫•y key: <a href="https://aistudio.google.com/apikey" target="_blank">https://aistudio.google.com/apikey</a></p>
    <p id="apiKeyError" style="color:red;"></p>
    <p id="loadingInit" style="color:green;"></p>
  </div>

  <!-- Main quiz content -->
  <div id="mainContent" style="display:none;">
    <h3>Ch·ªçn ch·ªß ƒë·ªÅ:</h3>
    <select id="topicSelect" onchange="handleCustomTopicToggle()">
      <option value="all">üìö √în t·∫≠p to√†n b·ªô</option>
      <option value="1">1. ƒê·ªëi t∆∞·ª£ng, ph∆∞∆°ng ph√°p nghi√™n c·ª©u, h·ªçc t·∫≠p v√† √Ω nghƒ©a</option>
      <option value="2">2. C∆° s·ªü, qu√° tr√¨nh h√¨nh th√†nh v√† ph√°t tri·ªÉn TTHCM</option>
      <option value="3">3. TTHCM v·ªÅ ƒë·ªôc l·∫≠p d√¢n t·ªôc & CNXH</option>
      <option value="4">4. TTHCM v·ªÅ ƒê·∫£ng & Nh√† n∆∞·ªõc c·ªông s·∫£n</option>
      <option value="5">5. TTHCM v·ªÅ ƒëo√†n k·∫øt to√†n d√¢n t·ªôc & qu·ªëc t·∫ø</option>
      <option value="6">6. TTHCM v·ªÅ vƒÉn h√≥a, ƒë·∫°o ƒë·ª©c, con ng∆∞·ªùi</option>
      <option value="custom">7. ‚ú® T√πy ch·ªçn ch·ªß ƒë·ªÅ</option>
    </select>

    <!-- Hi·ªÉn khung nh·∫≠p t·ª± ch·ªçn khi ch·ªçn 'custom' -->
    <div id="customTopicInput" style="display:none; margin-top:10px;">
      <input type="text" id="customTopicText" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ b·∫°n mu·ªën..."><br/>
      <small>GPT s·∫Ω t·ª± t·∫°o c√¢u h·ªèi xoay quanh ch·ªß ƒë·ªÅ n√†y</small>
    </div>

    <h3>Ch·ªçn s·ªë l∆∞·ª£ng c√¢u h·ªèi:</h3>
    <select id="numQuestions">
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="15">15</option>
      <option value="20">20</option>
    </select>

    <button onclick="startQuiz()">B·∫Øt ƒë·∫ßu</button>

    <div id="quiz" style="display:none;">
      <div id="questionNumber" style="margin-bottom: 10px; font-weight: bold;"></div>
      <p id="question"></p>
      <div id="options"></div>
      <button onclick="submitAnswer()">N·ªôp</button>
      <div id="feedback"></div>
      <button id="nextBtn" onclick="nextQuestion()">C√¢u ti·∫øp theo</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    function checkAndContinue() {
      const apiKey = document.getElementById("apiKeyInput").value.trim();
      const error = document.getElementById("apiKeyError");
      const loading = document.getElementById("loadingInit");

      if (!apiKey) {
        error.textContent = "Key kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
        return;
      }

      loading.textContent = "üîÑ ƒêang kh·ªüi t·∫°o...";

      fetch("http://localhost:3000/api/gemini", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: "Tr·∫£ l·ªùi: Xin ch√†o", apiKey })
      })
      .then(res => res.json())
      .then(data => {
        loading.textContent = "";
        if (data.result && data.result !== "Kh√¥ng c√≥ ph·∫£n h·ªìi.") {
          sessionStorage.setItem("API_KEY", apiKey);
          document.getElementById("apiKeyPrompt").style.display = "none";
          document.getElementById("mainContent").style.display = "block";
        } else {
          error.textContent = "Key kh√¥ng h·ª£p l·ªá. H√£y th·ª≠ l·∫°i.";
        }
      })
      .catch(() => {
        loading.textContent = "";
        error.textContent = "Key kh√¥ng h·ª£p l·ªá ho·∫∑c server l·ªói. H√£y th·ª≠ l·∫°i.";
      });
    }

    function handleCustomTopicToggle() {
      const select = document.getElementById("topicSelect");
      const customDiv = document.getElementById("customTopicInput");
      customDiv.style.display = select.value === "custom" ? "block" : "none";
    }
  </script>
  <script src="quiz.js"></script>
</body>
</html>
